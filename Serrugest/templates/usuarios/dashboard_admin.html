{% extends 'base.html' %}
{% load widget_tweaks %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'usuarios/css/modal_form.css' %}">

<h3>Panel de Administración</h3>

<form method="get" class="d-flex mb-3" role="search">
  <input class="form-control me-2" type="search" name="q" placeholder="Buscar usuario..." aria-label="Buscar">
  <button class="btn btn-outline-success" type="submit">Buscar</button>
</form>

<!-- Botón para abrir el modal -->
<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalRegistrarUsuario">
  Registrar nuevo usuario
</button>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Nombre de usuario</th>
      <th>Rol</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for user in usuarios %}
      <tr>
        <td>{{ user.username }}</td>
        <td>{{ user.rol }}</td>
        <td>
          <a href="#" class="btn btn-sm btn-warning">Editar</a>
          <a href="#" class="btn btn-sm btn-danger">Eliminar</a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="4">No se encontraron usuarios.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>



<!-- Modal -->
<div class="modal fade" id="modalRegistrarUsuario" tabindex="-1" aria-labelledby="modalRegistrarUsuarioLabel" aria-hidden="true">
  <div class="modal-dialog"> <!-- Cambiado a modal-md para un tamaño más adecuado -->
    <div class="modal-content">
      <form method="post" novalidate>
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="modalRegistrarUsuarioLabel">Registrar nuevo usuario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          {% for field in form %}
            <div class="form-row">
              <label for="{{ field.id_for_label }}">{{ field.label }}</label>
              {{ field|add_class:"form-control" }}
            </div>
            {% if field.errors %}
              <div class="text-danger small">
                {% for error in field.errors %}
                  • {{ error }}
                {% endfor %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Registrar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>


{% if form.errors %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var modal = new bootstrap.Modal(document.getElementById('modalRegistrarUsuario'));
    modal.show();
  });
</script>
{% endif %}

{% endblock %}
